name: Continuouss Architecture

environments:
  prod:
    test-project-1:
      vault: some-vault-identifier
  stage:
    test-project-1:
      file: .env.stage
    test-project-2:
      file: .env.stage

providers:
  aws:
    config:
      accountId: AWS_ACCOUNT_ID
      accessKeyId: AWS_ACCESS_KEY_ID
      secretAccessKey: AWS_SECRET_ACCESS_KEY
      region: AWS_DEFAULT_REGION
  heroku:
    config:
      username: HEROKU_USER
      password: HEROKU_PASSWORD

projects:
  api-server:
    path: $PROJECT_ROOT/tests/test-project-1
    modulePath: src/modules
    languages:
    - Typescript
    artifacts:
    - name: customer-api.zip
      deploys:
      - type: AWS Lambda
    - name: admin-api.zip
      deploys:
      - type: AWS Fargate
    interfaces:
    - key: files
    - key: messaging
    - key: database
    - key: rpc
  customer-mobile-app:
    path: $PROJECT_ROOT/tests/test-project-2
    modulePath: src/lib
    languages:
    - Typescript
    artifacts:
    - name: app.apk
      deploys:
      - type: Google Play Store
      - type: Filebucket
    - name: app.ipa
      deploys:
      - type: Apple App Store
      - type: Filebucket
    interfaces:
    - key: rpc
  admin-web-app:
    path: $PROJECT_ROOT/tests/test-project-2
    modulePath: src/lib
    languages:
    - Typescript
    artifacts:
    - name: admin-app.zip
      deploys:
      - type: S3/Cloudflare
    interfaces:
    - key: rpc

resources:
  file-bucket-resource:
    path: path/to/resource
  
  pubsub:
    path: path/to/resource

  database:
    path: path/to/resource

  api:
    path: path/to/resource

interfaces:
  files:
    name: 'File bucket'
    resources:
    - name: file-bucket-resource
    apis:
    - name: system-file-api
    - name: user-file-api

  messaging:
    name: 'PubSub'
    resources:
    - name: pubsub
    apis:
    - name: default

  database:
    name: 'Database'
    resources:
    - name: database
    apis:
    - name: database
      path: specs/mysql.yml
    service: mysql

  rpc:
    name: 'API'
    resources:
    - name: api
    apis:
    - name: rpc
      path: specs/api.yml

services:
  http:
    ssl: true
  mysql:
    provision: true
    connection:
      host: MYSQL_HOST
      port: MYSQL_PORT
      user: MYSQL_USER
      password: MYSQL_PASSWORD
